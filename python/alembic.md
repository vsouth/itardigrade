# Links
https://giki.wiki/@nubela/Software-Engineering/alembic
https://www.youtube.com/watch?v=bfelC61XKO4

---
# Notes
[[imports from other folders]]

--- 
# Workflow
- alembic init %% название новой директории - например, alembic или migrations %%
```
# IN /alembic/env.py FILE:
# Interpret the config file for Python logging.
# This line sets up loggers basically.
if config.config_file_name is not None:
    fileConfig(config.config_file_name)

# !!!!!!!!!!!!!!!!!>
import sys, os

sys.path.insert(0, os.path.dirname(os.path.dirname(__file__)))

import study_db.config as my_config

config.set_main_option("sqlalchemy.url", my_config.DATABASE_URI)
# <!!!!!!!!!!!!!!!!!

# add your model's MetaData object here
# for 'autogenerate' support
# from myapp import mymodel
# target_metadata = mymodel.Base.metadata

# !!!!!!!!!!!!!!!!!>
from study_db.models import Base

target_metadata = Base.metadata
# <!!!!!!!!!!!!!!!!!
```
- alembic stamp head
- change the model in models.py
- ask Alembic what's different about the models: 
	- alembic revision --autogenerate -m "Added %%price%% column"
- alembic upgrade head
- insert prices into this table 
	- py cli.py
```
from crud import Session
from models import Book

s = Session()

books = s.query(Book).all()

for book in books:
    price = input(f"Price for '{book.title}': $")
    book.price = price
    s.add(book)

s.commit()

print(s.query(Book.title, Book.price).all())

s.close()
```

---
# Something else
to rename a column:
```
def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.alter_column("books", "author", new_column_name="author_name")
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.alter_column("books", "author_name", new_column_name="author")
    # ### end Alembic commands ###
```